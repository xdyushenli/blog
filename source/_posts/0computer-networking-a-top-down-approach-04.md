---
title: 计算机网络：自顶向下方法读书笔记（四）
date: 2019-12-18 20:01:09
tags: [ 计算机网络, IP ]
---
本章我们来到了网络层。与运输层不同, 网络层存在于处在网络内部的每一台主机和路由器上。
网络层比较复杂, 可以分为两个相互独立但共同作用的部分: **数据平面**和**控制平面**。其基础协议是 IP 协议。本章主要涉及**网络层数据平面的相关知识。**
本章主要回答下面这些问题:
* 网络层数据平面的功能是什么?
* 路由器是如何实现网络层数据平面的功能的?
* 传统的基于 IP 的转发是如何实现的?
* 更为一般的转发是如何实现的?

# 网络层概述
我们将网络层使用的包称为`数据报(datagram)`。

网络层数据平面与控制平面的功能:
* 数据平面的功能: 转发。
* 控制平面的功能: 控制向哪里转发。这个功能还有一个高大上的名字, 叫路由选择。

`转发(forwarding)`和`路由选择(routing)`之间的区别是:
* **转发**指的是将一个数据报从一个链路转发到另一个链路的动作, 时间多为几纳秒, 通常用硬件来实现。
* **路由选择**是指确定数据报从发送端到接收端的路径的处理过程, 时间多为几秒, 通常用软件来实现。

为了实现控制平面的功能, 需要在路由器中存放一个`转发表(forwarding table)`。转发表会告知路由器具有特定首部值的数据报应该向哪条链路进行转发。

转发表一般有两种定义方式:
* 路由器与路由器之间通过路由选择协议交换包含路由信息的报文, 从而生成转发表。
在这种方式中, 路由器既实现了数据平面的功能, 也实现了控制平面的功能。
* 远程控制器计算转发表, 并向路由器进行分发。远程控制器存放在数据中心中, 由第三方或 ISP 进行管理。
通过这种方式, 路由器和远程控制器一起, 构成了一个实现了网络层所有功能的网络。由于这种网络的行为是通过远程控制器中的软件计算出来的, 因此将这样的网络称为`软件定义(的)网络(SDN, Software-Defined Networking)`。
在这种方式中, 路由器仅实现了数据平面的功能, 控制平面的功能由远程控制器实现。

**网络层提供的是尽力而为的服务(best-effort service)。**也就是说, 网络层不对数据报正确交付做任何承诺!

# 路由器工作原理
本节主要回答了路由器是如何将数据报从入链路转发到合适的出链路的。

